C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE menu_Ui
OBJECT MODULE PLACED IN .\Objects\menu_Ui.obj
COMPILER INVOKED BY: D:\keil\C251\BIN\C251.EXE Menu\menu_Ui.c XSMALL BROWSE INCDIR(.\ADC;.\I2C;.\LCD;.\System;.\UART1;.\
                    -Menu;.\KEY;..\实战-电流计_V2.0;.\Timer;.\SPI_Handler;.\CH224K;.\Pwm) DEBUG PRINT(.\Listings\menu_Ui.lst) TABS(2) OBJECT(
                    -.\Objects\menu_Ui.obj) 

stmt  level    source

    1          /*
    2          *注意：使用keil需要设置为GB2312
    3          *==============================多级菜单源文件=======================
    4          *-------------------------------------------------------------------
    5          *文件修改历史
    6          *<时间>    | <版本>  | <作者>  | <功能>  
    7          *2023.2.24 | V1.0.2   | 小夏    | 多级菜单UI显示（PD诱骗界面,曲线显示界面等）
    8          *-------------------------------------------------------------------
    9          */
   10          
   11          #include "menu_Ui.h"
   12          #include "String.h"
   13          #include "I2C.h"
   14          #include "AHT10.h"
   15          #include "ADC.h"
   16          //#include "Pic.h"
   17          #include "menu.h"
   18          #include "KEY.h"
   19          #include "TIMER.h"
   20          ADC_Get_Value ADC_Get;
   21          float ADC_Voltage;
   22          float ALL_temp=0;
   23          AHT AHT10;
   24          u8 humi_char[12];
   25          u8 temp_char[12];
   26          //电池组别
   27          u8 Power;
   28          u8 Power_String[12];
   29          u8 FLAGS;
   30          
   31          float ADC_Max_Min;
   32          
   33          u8 ADC_GET_V_X=10;
   34          u8 ADC_GET_V_Y=100;
   35          u16 CH_Y;
   36          u8 Voltage_range_Flag;
   37          u8 Voltage_range_Flag_Tow;
   38          u8 Voltage_range_Flag_Three;
   39          
   40          ALL_Value Line;
   41          Current_Range_Flag C_Range;
   42          u8 Voltage_Ripple_Nember=13;
   43          
   44          ADC_Power Range;
   45          
   46          Current_Temp_protect C_T_P;
   47          u16 Temp_ALL_Value;
   48          u8 Voltage_Level_Flag;
   49          u8 fast_charge_Flag;
   50          
   51          /*-------------------------------------------------------------
   52          *功能：一级主界面的显示
   53          *作者：小夏
   54          *修改时间：2023.2.24
   55          *参考：大脑（自己）
   56          *-------------------------------------------------------------*/
   57          void menu_Ui_main(void){
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 2   

   58   1      
   59   1        ADC_Get.Voltage_Value=ADC_Voltage_Read_Value_average();
   60   1        //显示电压 36*36
   61   1        LCD_ShowFloatNum1(4,19,  ADC_Get.Voltage_Value,5,YELLOW,BLACK,32);
   62   1        LCD_ShowString(104,19,"V",YELLOW,BLACK,32,0);
   63   1        
   64   1        //显示电流 36*36  
   65   1        ADC_Get.Current_Value=ADC_Read_current_Value_average();//0.0399
   66   1        LCD_ShowFloatNum1(4,50, ADC_Get.Current_Value,5,BLUE,BLACK,32);
   67   1        LCD_ShowString(104,50,"A",BLUE,BLACK,32,0); 
   68   1        //显示功率 36*36  
   69   1        LCD_ShowFloatNum1(4,82, ADC_Get.Current_Value*ADC_Get.Voltage_Value,5,RED_NOW,BLACK,32);
   70   1        LCD_ShowString(104,82,"W",RED_NOW ,BLACK,32,0);  
   71   1        //显示温湿度  
   72   1        
   73   1        AHT10_Read_Humi_Temp(&AHT10.humi,&AHT10.temp);
   74   1        ALL_temp=((AHT10.temp/100)*10)+(AHT10.temp%100/10);
   75   1        sprintf(humi_char,"%d%d.%d%%",AHT10.humi/100,AHT10.humi%100/10,AHT10.humi%100%10);
   76   1        sprintf(temp_char,"%d%d.%dC",AHT10.temp/100,AHT10.temp%100/10,AHT10.temp%100%10);
   77   1        LCD_ShowString(162,0,temp_char,RED,BLACK,12,0);
   78   1        LCD_Fill(192,0,204,12,BLACK);
   79   1        LCD_ShowString(209,0,humi_char,GREEN,BLACK,12,0);   
   80   1        //显示电阻
   81   1      //  LCD_ShowFloatNum(150,21,  ADC_Get.Voltage_Value/ADC_Get.Current_Value,6,PINK_RED,BLACK,16);
   82   1      //  LCD_ShowString(225-18,21,"R",PINK_RED,BLACK,16,0);  
   83   1      //  //显示电池组别
   84   1      //  LCD_ShowChinese16x16(151,40,"组",WHITE,BLACK,16,0);
   85   1      //  LCD_ShowChinese16x16(151+16,40,"别",WHITE,BLACK,16,0);
   86   1      //  if(ADC_Get.Voltage_Value>=0 && ADC_Get.Voltage_Value<=6.0) Power=1; 
   87   1      //  if(ADC_Get.Voltage_Value>=6.0 && ADC_Get.Voltage_Value<=10.0) Power=2;
   88   1      //  if(ADC_Get.Voltage_Value>=10.0 && ADC_Get.Voltage_Value<=13.0) Power=3;
   89   1      //  if(ADC_Get.Voltage_Value>=13.0 && ADC_Get.Voltage_Value<=17) Power=4;
   90   1      //  if(ADC_Get.Voltage_Value>=17.0 && ADC_Get.Voltage_Value<=21) Power=5; 
   91   1      //  sprintf(Power_String,"%d/5",Power);
   92   1      //  LCD_ShowString(151+34,40,Power_String,WHITE,BLACK,16,0);  
   93   1        //显示Wh
   94   1        //显示时间
   95   1        LCD_ShowIntNum(151+8,18,T_D.H,2,WHITE,BLACK,12);
   96   1        LCD_ShowString(151+12+8,18,":",WHITE,BLACK,12,0);
   97   1        LCD_ShowIntNum(151+12+8+8,18,T_D.M,2,WHITE,BLACK,12);
   98   1        LCD_ShowString(151+20+12+8,18,":",WHITE,BLACK,12,0);  
   99   1        LCD_ShowIntNum(151+20+12+8+8,18,T_D.S,2,WHITE,BLACK,12);
  100   1        //显示mah
  101   1      
  102   1        LCD_ShowFloatNum5(151+8,18+12,umA_Num_Sum,6,BLUE,BLACK,12);
  103   1        LCD_ShowString(151+8+36+8,18+12,"Ah",BLUE,BLACK,12,0);
  104   1        LCD_ShowFloatNum5(151+8,18+24,uW_Num_Sum,6,YELLOW,BLACK,12);
  105   1        LCD_ShowString(151+8+36+8,18+24,"Wh",YELLOW,BLACK,12,0);  
  106   1        //显示最大电压，电流，功率
  107   1        LCD_ShowString(150,59,"MAX",RED,BLACK,12,0);
  108   1        LCD_ShowString(198,59,"MIN",GREEN,BLACK,12,0);
  109   1        
  110   1        if(Range.V_Max<ADC_Get.Voltage_Value) Range.V_Max=ADC_Get.Voltage_Value;  
  111   1        LCD_ShowFloatNum1(138,71, Range.V_Max,5,YELLOW,BLACK,12);//电压最大值
  112   1        LCD_ShowString(174,71,"V",YELLOW,BLACK,12,0);
  113   1      
  114   1        if(Range.C_Max<ADC_Get.Current_Value) Range.C_Max=ADC_Get.Current_Value;
  115   1        LCD_ShowFloatNum1(138,82, Range.C_Max,5,BLUE,BLACK,12);//电流最大值 
  116   1        LCD_ShowString(174,82,"A",BLUE,BLACK,12,0);
  117   1        
  118   1        ADC_Get.Power_Value=ADC_Get.Current_Value*ADC_Get.Voltage_Value;
  119   1        if(Range.W_Max<ADC_Get.Power_Value) Range.W_Max=ADC_Get.Power_Value;  
  120   1        LCD_ShowFloatNum1(138,94,Range.W_Max,5,RED_NOW,BLACK,12);//功率最大值 
  121   1        LCD_ShowString(174,94,"W",RED_NOW,BLACK,12,0);  
  122   1        //显示最小电压，电流，功率
  123   1          if(Range.V_Min>ADC_Get.Voltage_Value) Range.V_Min=ADC_Get.Voltage_Value;
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 3   

  124   1        LCD_ShowFloatNum1(188,71, Range.V_Min,5,YELLOW,BLACK,12);//电压最小值
  125   1        LCD_ShowString(188+36,71,"V",YELLOW,BLACK,12,0);
  126   1        
  127   1          if(Range.C_Min>ADC_Get.Current_Value) Range.C_Min=ADC_Get.Current_Value;
  128   1        LCD_ShowFloatNum1(188,82, Range.C_Min,5,BLUE,BLACK,12);//电流最小值 
  129   1        LCD_ShowString(188+36,82,"A",BLUE,BLACK,12,0);
  130   1      
  131   1          if(Range.W_Min>ADC_Get.Power_Value) Range.W_Min=ADC_Get.Power_Value;  
  132   1        LCD_ShowFloatNum1(188,94, Range.W_Min,5,RED_NOW,BLACK,12);//功率最小值  
  133   1        LCD_ShowString(188+36,94,"W",RED_NOW,BLACK,12,0); 
  134   1        //显示NOMS开关状态
  135   1        LCD_ShowString(5,120,"NMOS:",BLUE,BLACK,16,0);
  136   1        if(P16==1){
  137   2          LCD_ShowChinese12x12(48,123,"开",WHITE,BLACK,12,0);
  138   2        }else{
  139   2          LCD_ShowChinese12x12(48,123,"关",WHITE,BLACK,12,0);   
  140   2        }
  141   1        if(Dispaly_Ch_Flag==0){     
  142   2          LCD_ShowChinese12x12(68,123,"一",GREEN,BLACK,12,0);
  143   2          LCD_ShowChinese12x12(68+12,123,"般",GREEN,BLACK,12,0);  
  144   2          LCD_ShowChinese12x12(68+24,123,"开",GREEN,BLACK,12,0);
  145   2          LCD_ShowChinese12x12(68+36,123,"启",GREEN,BLACK,12,0);  
  146   2        }else if(Dispaly_Ch_Flag==1){     
  147   2          LCD_ShowChinese12x12(68,123,"过",RED,BLACK,12,0);
  148   2          LCD_ShowChinese12x12(68+12,123,"流",RED,BLACK,12,0);  
  149   2          LCD_ShowChinese12x12(68+24,123,"保",RED,BLACK,12,0);
  150   2          LCD_ShowChinese12x12(68+36,123,"护",RED,BLACK,12,0);  
  151   2        }else if(Dispaly_Ch_Flag==2){     
  152   2          LCD_ShowChinese12x12(68,123,"过",RED,BLACK,12,0);
  153   2          LCD_ShowChinese12x12(68+12,123,"温",RED,BLACK,12,0);  
  154   2          LCD_ShowChinese12x12(68+24,123,"保",RED,BLACK,12,0);
  155   2          LCD_ShowChinese12x12(68+36,123,"护",RED,BLACK,12,0);  
  156   2        }
  157   1        //显示D+,D-
  158   1        ADC_Get.D_LEFT_Voltage_Value=ADC_D_LEFT_Read_Value_average();
  159   1        LCD_ShowString(140,110,"D+:",YELLOW,BLACK,12,0);
  160   1        LCD_ShowFloatNum1(140+24,110,ADC_Get.D_LEFT_Voltage_Value,5,YELLOW,BLACK,12);
  161   1        LCD_ShowString(140+24+36,110,"V",YELLOW,BLACK,12,0);
  162   1        
  163   1        ADC_Get.D_RIGHT_Voltage_Value=ADC_D_RIGHT_Read_Value_average();
  164   1        LCD_ShowString(140,122,"D-:",GREEN,BLACK,12,0);
  165   1        LCD_ShowFloatNum1(140+24,122,ADC_Get.D_RIGHT_Voltage_Value,5,GREEN,BLACK,12);
  166   1        LCD_ShowString(140+24+36,122,"V",GREEN,BLACK,12,0); 
  167   1        //显示是否触发快充协议
  168   1        LCD_ShowChinese12x12(4,0,"是",WHITE,BLACK,12,0);
  169   1        LCD_ShowChinese12x12(4+12,0,"否",WHITE,BLACK,12,0); 
  170   1        LCD_ShowChinese12x12(4+24,0,"开",WHITE,BLACK,12,0);
  171   1        LCD_ShowChinese12x12(4+36,0,"启",WHITE,BLACK,12,0);
  172   1        LCD_ShowChinese12x12(4+48,0,"快",WHITE,BLACK,12,0);
  173   1        LCD_ShowChinese12x12(4+60,0,"充",WHITE,BLACK,12,0);
  174   1        //----------------------------------快充协议检测---------------------------------------------
  175   1        if((ADC_Get.D_LEFT_Voltage_Value>0.4&&ADC_Get.D_LEFT_Voltage_Value<0.9)&&(ADC_Get.D_RIGHT_Voltage_Value>
             -0&&ADC_Get.D_RIGHT_Voltage_Value<0.3)){
  176   2          fast_charge_Flag=1;
  177   2          LCD_ShowString(80+12+10,0,"QC2  5V",GREEN,BLACK,12,0);    
  178   2        }else if((ADC_Get.D_LEFT_Voltage_Value>2.2&&ADC_Get.D_LEFT_Voltage_Value<3.3)&&(ADC_Get.D_RIGHT_Voltage_
             -Value>0.5&&ADC_Get.D_RIGHT_Voltage_Value<0.9)){
  179   2          fast_charge_Flag=1;
  180   2          LCD_ShowString(80+12+10,0,"QC2  9V",GREEN,BLACK,12,0);          
  181   2        }else if((ADC_Get.D_LEFT_Voltage_Value>0.4&&ADC_Get.D_LEFT_Voltage_Value<0.9)&&(ADC_Get.D_RIGHT_Voltage_
             -Value>0.5&&ADC_Get.D_RIGHT_Voltage_Value<0.9)){
  182   2          fast_charge_Flag=1;
  183   2          LCD_ShowString(80+12+10,0,"QC2 12V",GREEN,BLACK,12,0);    
  184   2        }else if((ADC_Get.D_LEFT_Voltage_Value>2.2&&ADC_Get.D_LEFT_Voltage_Value<3.3)&&(ADC_Get.D_RIGHT_Voltage_
             -Value>2.2&&ADC_Get.D_RIGHT_Voltage_Value<3.3)){
  185   2          fast_charge_Flag=1;
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 4   

  186   2          LCD_ShowString(80+12+10,0,"QC2 20V",GREEN,BLACK,12,0);    
  187   2        }else if((ADC_Get.D_LEFT_Voltage_Value>0.4&&ADC_Get.D_LEFT_Voltage_Value<0.9)&&(ADC_Get.D_RIGHT_Voltage_
             -Value>2.2&&ADC_Get.D_RIGHT_Voltage_Value<3.3)){
  188   2          fast_charge_Flag=1;
  189   2          LCD_ShowString(80+12+10,0,"QC  3.0",GREEN,BLACK,12,0);          
  190   2        }
  191   1        
  192   1        else{
  193   2          fast_charge_Flag =0;
  194   2          LCD_ShowString(80+12+10,0,"N  None",GREEN,BLACK,12,0);
  195   2        }
  196   1      
  197   1        
  198   1        if(ADC_Get.Voltage_Value>=6|fast_charge_Flag==1 ){
  199   2          LCD_ShowChinese12x12(4+76,0,"开",RED,BLACK,12,0);       
  200   2        }else{
  201   2          LCD_ShowChinese12x12(4+76,0,"关",WHITE,BLACK,12,0);   
  202   2        }
  203   1      }
  204          /*-------------------------------------------------------------
  205          *功能：二级菜单显示
  206          *作者：小夏
  207          *修改时间：2023.2.24
  208          *参考：大脑（自己）
  209          *-------------------------------------------------------------*/
  210          u8 menu_Ui_Choose_Menu(u8 Menu_FLAG){
  211   1      
  212   1        if(Menu_FLAG ==0){
  213   2          //快充诱骗
  214   2          LCD_ShowChinese24x24(8,8,"快",YELLOW,GREEN,24,0);
  215   2          LCD_ShowChinese24x24(8+24,8,"充",YELLOW,GREEN,24,0);
  216   2          LCD_ShowChinese24x24(8+48,8,"诱",YELLOW,GREEN,24,0);
  217   2          LCD_ShowChinese24x24(8+72,8,"骗",YELLOW,GREEN,24,0);
  218   2          //离线功率
  219   2          LCD_ShowChinese24x24(8,40,"离",YELLOW,BLACK,24,0);
  220   2          LCD_ShowChinese24x24(8+24,40,"线",YELLOW,BLACK,24,0);
  221   2          LCD_ShowChinese24x24(8+48,40,"功",YELLOW,BLACK,24,0);
  222   2          LCD_ShowChinese24x24(8+72,40,"率",YELLOW,BLACK,24,0);   
  223   2          //低速纹波
  224   2          LCD_ShowChinese24x24(8,72,"低",YELLOW,BLACK,24,0);
  225   2          LCD_ShowChinese24x24(8+24,72,"速",YELLOW,BLACK,24,0);
  226   2          LCD_ShowChinese24x24(8+48,72,"压",YELLOW,BLACK,24,0);
  227   2          LCD_ShowChinese24x24(8+72,72,"差",YELLOW,BLACK,24,0); 
  228   2          //电流温度保护
  229   2          LCD_ShowChinese24x24(8,104,"电",YELLOW,BLACK,24,0);
  230   2          LCD_ShowChinese24x24(8+24,104,"流",YELLOW,BLACK,24,0);
  231   2          LCD_ShowChinese24x24(8+48,104,"温",YELLOW,BLACK,24,0);
  232   2          LCD_ShowChinese24x24(8+72,104,"度",YELLOW,BLACK,24,0);
  233   2          LCD_ShowChinese24x24(8+72+24,104,"保",YELLOW,BLACK,24,0);
  234   2          LCD_ShowChinese24x24(8+72+48,104,"护",YELLOW,BLACK,24,0);   
  235   2          return 1;
  236   2        }
  237   1        if(Menu_FLAG ==1){
  238   2          //快充诱骗
  239   2          LCD_ShowChinese24x24(8,8,"快",YELLOW,BLACK,24,0);
  240   2          LCD_ShowChinese24x24(8+24,8,"充",YELLOW,BLACK,24,0);
  241   2          LCD_ShowChinese24x24(8+48,8,"诱",YELLOW,BLACK,24,0);
  242   2          LCD_ShowChinese24x24(8+72,8,"骗",YELLOW,BLACK,24,0);
  243   2          //离线功率
  244   2          LCD_ShowChinese24x24(8,40,"离",YELLOW,GREEN,24,0);
  245   2          LCD_ShowChinese24x24(8+24,40,"线",YELLOW,GREEN,24,0);
  246   2          LCD_ShowChinese24x24(8+48,40,"功",YELLOW,GREEN,24,0);
  247   2          LCD_ShowChinese24x24(8+72,40,"率",YELLOW,GREEN,24,0);   
  248   2          //低速纹波
  249   2          LCD_ShowChinese24x24(8,72,"低",YELLOW,BLACK,24,0);
  250   2          LCD_ShowChinese24x24(8+24,72,"速",YELLOW,BLACK,24,0);
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 5   

  251   2          LCD_ShowChinese24x24(8+48,72,"压",YELLOW,BLACK,24,0);
  252   2          LCD_ShowChinese24x24(8+72,72,"差",YELLOW,BLACK,24,0); 
  253   2          //电流温度保护
  254   2          LCD_ShowChinese24x24(8,104,"电",YELLOW,BLACK,24,0);
  255   2          LCD_ShowChinese24x24(8+24,104,"流",YELLOW,BLACK,24,0);
  256   2          LCD_ShowChinese24x24(8+48,104,"温",YELLOW,BLACK,24,0);
  257   2          LCD_ShowChinese24x24(8+72,104,"度",YELLOW,BLACK,24,0);
  258   2          LCD_ShowChinese24x24(8+72+24,104,"保",YELLOW,BLACK,24,0);
  259   2          LCD_ShowChinese24x24(8+72+48,104,"护",YELLOW,BLACK,24,0); 
  260   2          return 2;   
  261   2        }
  262   1        if(Menu_FLAG ==2){
  263   2          //快充诱骗
  264   2          LCD_ShowChinese24x24(8,8,"快",YELLOW,BLACK,24,0);
  265   2          LCD_ShowChinese24x24(8+24,8,"充",YELLOW,BLACK,24,0);
  266   2          LCD_ShowChinese24x24(8+48,8,"诱",YELLOW,BLACK,24,0);
  267   2          LCD_ShowChinese24x24(8+72,8,"骗",YELLOW,BLACK,24,0);
  268   2          //离线功率
  269   2          LCD_ShowChinese24x24(8,40,"离",YELLOW,BLACK,24,0);
  270   2          LCD_ShowChinese24x24(8+24,40,"线",YELLOW,BLACK,24,0);
  271   2          LCD_ShowChinese24x24(8+48,40,"功",YELLOW,BLACK,24,0);
  272   2          LCD_ShowChinese24x24(8+72,40,"率",YELLOW,BLACK,24,0);   
  273   2          //低速纹波
  274   2          LCD_ShowChinese24x24(8,72,"低",YELLOW,GREEN,24,0);
  275   2          LCD_ShowChinese24x24(8+24,72,"速",YELLOW,GREEN,24,0);
  276   2          LCD_ShowChinese24x24(8+48,72,"压",YELLOW,GREEN,24,0);
  277   2          LCD_ShowChinese24x24(8+72,72,"差",YELLOW,GREEN,24,0); 
  278   2          //电流温度保护
  279   2          LCD_ShowChinese24x24(8,104,"电",YELLOW,BLACK,24,0);
  280   2          LCD_ShowChinese24x24(8+24,104,"流",YELLOW,BLACK,24,0);
  281   2          LCD_ShowChinese24x24(8+48,104,"温",YELLOW,BLACK,24,0);
  282   2          LCD_ShowChinese24x24(8+72,104,"度",YELLOW,BLACK,24,0);
  283   2          LCD_ShowChinese24x24(8+72+24,104,"保",YELLOW,BLACK,24,0);
  284   2          LCD_ShowChinese24x24(8+72+48,104,"护",YELLOW,BLACK,24,0);     
  285   2          return 3;
  286   2        }
  287   1        if(Menu_FLAG ==3){
  288   2          LCD_ShowChinese24x24(8,8,"快",YELLOW,BLACK,24,0);
  289   2          LCD_ShowChinese24x24(8+24,8,"充",YELLOW,BLACK,24,0);
  290   2          LCD_ShowChinese24x24(8+48,8,"诱",YELLOW,BLACK,24,0);
  291   2          LCD_ShowChinese24x24(8+72,8,"骗",YELLOW,BLACK,24,0);
  292   2          //离线功率
  293   2          LCD_ShowChinese24x24(8,40,"离",YELLOW,BLACK,24,0);
  294   2          LCD_ShowChinese24x24(8+24,40,"线",YELLOW,BLACK,24,0);
  295   2          LCD_ShowChinese24x24(8+48,40,"功",YELLOW,BLACK,24,0);
  296   2          LCD_ShowChinese24x24(8+72,40,"率",YELLOW,BLACK,24,0);   
  297   2          //低速纹波
  298   2          LCD_ShowChinese24x24(8,72,"低",YELLOW,BLACK,24,0);
  299   2          LCD_ShowChinese24x24(8+24,72,"速",YELLOW,BLACK,24,0);
  300   2          LCD_ShowChinese24x24(8+48,72,"压",YELLOW,BLACK,24,0);
  301   2          LCD_ShowChinese24x24(8+72,72,"差",YELLOW,BLACK,24,0); 
  302   2          //电流温度保护
  303   2          LCD_ShowChinese24x24(8,104,"电",YELLOW,GREEN,24,0);
  304   2          LCD_ShowChinese24x24(8+24,104,"流",YELLOW,GREEN,24,0);
  305   2          LCD_ShowChinese24x24(8+48,104,"温",YELLOW,GREEN,24,0);
  306   2          LCD_ShowChinese24x24(8+72,104,"度",YELLOW,GREEN,24,0);
  307   2          LCD_ShowChinese24x24(8+72+24,104,"保",YELLOW,GREEN,24,0);
  308   2          LCD_ShowChinese24x24(8+72+48,104,"护",YELLOW,GREEN,24,0);     
  309   2          return 4;
  310   2        }
  311   1        return 0;
  312   1      }
  313          /*-------------------------------------------------------------
  314          *功能：三级菜单级->诱骗界面显示
  315          *作者：小夏
  316          *修改时间：2023.2.24
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 6   

  317          *参考：大脑（自己）
  318          *-------------------------------------------------------------*/
  319          u8 menu_Ui_PD_QC_Menu(u8 Menu_FLAG){
  320   1      
  321   1          if(Menu_FLAG==0){
  322   2          //PD快充协议
  323   2          LCD_ShowString(6,8,"PD",YELLOW,GREEN,24,0);
  324   2          LCD_ShowChinese24x24(6+24,8,"快",YELLOW,GREEN,24,0);
  325   2          LCD_ShowChinese24x24(6+48,8,"充",YELLOW,GREEN,24,0);
  326   2          LCD_ShowChinese24x24(6+72,8,"诱",YELLOW,GREEN,24,0);
  327   2          LCD_ShowChinese24x24(6+72+24,8,"骗",YELLOW,GREEN,24,0);
  328   2          //QC快充协议
  329   2          LCD_ShowString(6,35,"QC",YELLOW,BLACK,24,0);
  330   2          LCD_ShowChinese24x24(6+24,35,"快",YELLOW,BLACK,24,0);
  331   2          LCD_ShowChinese24x24(6+48,35,"充",YELLOW,BLACK,24,0);
  332   2          LCD_ShowChinese24x24(6+72,35,"诱",YELLOW,BLACK,24,0);
  333   2          LCD_ShowChinese24x24(6+72+24,35,"骗",YELLOW,BLACK,24,0);
  334   2          //普通5V输入
  335   2      
  336   2          LCD_ShowChinese24x24(6,67,"普",YELLOW,BLACK,24,0);
  337   2          LCD_ShowChinese24x24(6+24,67,"通",YELLOW,BLACK,24,0);
  338   2          LCD_ShowString(6+48,67,"5V",YELLOW,BLACK,24,0);   
  339   2          LCD_ShowChinese24x24(6+72,67,"输",YELLOW,BLACK,24,0);
  340   2          LCD_ShowChinese24x24(6+72+24,67,"出",YELLOW,BLACK,24,0);
  341   2         // return 1;   
  342   2        }
  343   1        if(Menu_FLAG==1){
  344   2          //PD快充协议
  345   2          LCD_ShowString(6,8,"PD",YELLOW,BLACK,24,0);
  346   2          LCD_ShowChinese24x24(6+24,8,"快",YELLOW,BLACK,24,0);
  347   2          LCD_ShowChinese24x24(6+48,8,"充",YELLOW,BLACK,24,0);
  348   2          LCD_ShowChinese24x24(6+72,8,"诱",YELLOW,BLACK,24,0);
  349   2          LCD_ShowChinese24x24(6+72+24,8,"骗",YELLOW,BLACK,24,0);
  350   2          //QC快充协议
  351   2          LCD_ShowString(6,35,"QC",YELLOW,GREEN,24,0);
  352   2          LCD_ShowChinese24x24(6+24,35,"快",YELLOW,GREEN,24,0);
  353   2          LCD_ShowChinese24x24(6+48,35,"充",YELLOW,GREEN,24,0);
  354   2          LCD_ShowChinese24x24(6+72,35,"诱",YELLOW,GREEN,24,0);
  355   2          LCD_ShowChinese24x24(6+72+24,35,"骗",YELLOW,GREEN,24,0);
  356   2          //普通5V输入
  357   2      
  358   2          LCD_ShowChinese24x24(6,67,"普",YELLOW,BLACK,24,0);
  359   2          LCD_ShowChinese24x24(6+24,67,"通",YELLOW,BLACK,24,0);
  360   2          LCD_ShowString(6+48,67,"5V",YELLOW,BLACK,24,0);   
  361   2          LCD_ShowChinese24x24(6+72,67,"输",YELLOW,BLACK,24,0);
  362   2          LCD_ShowChinese24x24(6+72+24,67,"出",YELLOW,BLACK,24,0);
  363   2         // return 2;   
  364   2          }
  365   1          if(Menu_FLAG==2){
  366   2          //PD快充协议
  367   2          LCD_ShowString(6,8,"PD",YELLOW,BLACK,24,0);
  368   2          LCD_ShowChinese24x24(6+24,8,"快",YELLOW,BLACK,24,0);
  369   2          LCD_ShowChinese24x24(6+48,8,"充",YELLOW,BLACK,24,0);
  370   2          LCD_ShowChinese24x24(6+72,8,"诱",YELLOW,BLACK,24,0);
  371   2          LCD_ShowChinese24x24(6+72+24,8,"骗",YELLOW,BLACK,24,0);
  372   2          //QC快充协议
  373   2          LCD_ShowString(6,35,"QC",YELLOW,BLACK,24,0);
  374   2          LCD_ShowChinese24x24(6+24,35,"快",YELLOW,BLACK,24,0);
  375   2          LCD_ShowChinese24x24(6+48,35,"充",YELLOW,BLACK,24,0);
  376   2          LCD_ShowChinese24x24(6+72,35,"诱",YELLOW,BLACK,24,0);
  377   2          LCD_ShowChinese24x24(6+72+24,35,"骗",YELLOW,BLACK,24,0);
  378   2          //普通5V输入
  379   2      
  380   2          LCD_ShowChinese24x24(6,67,"普",YELLOW,GREEN,24,0);
  381   2          LCD_ShowChinese24x24(6+24,67,"通",YELLOW,GREEN,24,0);
  382   2          LCD_ShowString(6+48,67,"5V",YELLOW,GREEN,24,0);   
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 7   

  383   2          LCD_ShowChinese24x24(6+72,67,"输",YELLOW,GREEN,24,0);
  384   2          LCD_ShowChinese24x24(6+72+24,67,"出",YELLOW,GREEN,24,0);
  385   2          //return 3;   
  386   2        }
  387   1        //显示温湿度  
  388   1        
  389   1        AHT10_Read_Humi_Temp(&AHT10.humi,&AHT10.temp);
  390   1        ALL_temp=((AHT10.temp/100)*10)+(AHT10.temp%100/10);
  391   1        sprintf(humi_char,"%d%d.%d%%",AHT10.humi/100,AHT10.humi%100/10,AHT10.humi%100%10);
  392   1        sprintf(temp_char,"%d%d.%dC",AHT10.temp/100,AHT10.temp%100/10,AHT10.temp%100%10);
  393   1        LCD_ShowString(20,96,temp_char,RED,BLACK,16,0);
  394   1        LCD_DrawRectangle(11, 114, 64, 115,WHITE);
  395   1        LCD_ShowString(20,118,humi_char,GREEN,BLACK,16,0);    
  396   1        //显示图片
  397   1        //LCD_ShowPicture(143,15,94,82,gImage_KUI);
  398   1        //显示USB夔牛>>
  399   1        LCD_ShowString(145,113,"USB",BLUE,BLACK,16,0);
  400   1        LCD_ShowChinese16x16(145+24,113,"夔",YELLOW,BLACK,16,0);
  401   1        LCD_ShowChinese16x16(145+24+16,113,"牛",YELLOW,BLACK,16,0); 
  402   1        LCD_ShowString(145+25+32,113,">>",RED_NOW,BLACK,16,0);
  403   1          return 0;
  404   1      }
  405          /*-------------------------------------------------------------
  406          *功能：三级菜单级->界面显示
  407          *作者：小夏
  408          *修改时间：2023.2.24
  409          *参考：大脑（自己）
  410          *-------------------------------------------------------------*/
  411          void menu_Ui_Voltage_current_Line_Menu(void){
  412   1        //显示电压
  413   1        ADC_Get.Voltage_Value=ADC_Voltage_Read_Value_Line();
  414   1        LCD_ShowFloatNum1(45,3,  ADC_Get.Voltage_Value,5,YELLOW,BLACK,12);
  415   1        LCD_ShowString(81,3,"V",YELLOW,BLACK,12,0);
  416   1        
  417   1        //显示电流 
  418   1        ADC_Get.Current_Value=ADC_Read_current_Value_average();
  419   1        LCD_ShowFloatNum1(154,3,  ADC_Get.Current_Value,5,BLUE,BLACK,12);
  420   1        LCD_ShowString(190,3,"A",BLUE,BLACK,12,0);
  421   1      
  422   1        //显示功率
  423   1        LCD_ShowFloatNum1(78,119,ADC_Get.Voltage_Value*ADC_Get.Current_Value,5,RED_NOW,BLACK,12);
  424   1        LCD_ShowString(114,119,"W",RED_NOW,BLACK,12,0); 
  425   1      //显示周期
  426   1        if(Time_Change_FLAG==0) LCD_ShowString(102,3,"T:60S",WHITE,BLACK,12,0); 
  427   1        else if(Time_Change_FLAG==1) LCD_ShowString(102,3,"T:30S",WHITE,BLACK,12,0);  
  428   1        else if(Time_Change_FLAG==2) LCD_ShowString(102,3,"T:10S",WHITE,BLACK,12,0);    
  429   1        else if(Time_Change_FLAG==3) LCD_ShowString(102,3,"T:1S",WHITE,BLACK,12,0); 
  430   1        else if(Time_Change_FLAG==4) LCD_ShowString(102-6,3,"T:500ms",WHITE,BLACK,12,0);
  431   1        else if(Time_Change_FLAG==5) LCD_ShowString(102-6,3,"T:200ms",WHITE,BLACK,12,0);
  432   1        else if(Time_Change_FLAG==6) LCD_ShowString(102-6,3,"T:100ms",WHITE,BLACK,12,0);  
  433   1        else if(Time_Change_FLAG==7) LCD_ShowString(102-6,3,"T:50ms",WHITE,BLACK,12,0);
  434   1        else if(Time_Change_FLAG==8) LCD_ShowString(102-6,3,"T:20ms",WHITE,BLACK,12,0);
  435   1        if(Begin_Stop_Flag ==0){
  436   2        //刷新离线的电流数据
  437   2        if(X_Line_Loop_FLAG==1){
  438   3              ADC_Get.Voltage_Value=ADC_Voltage_Read_Value_average();
  439   3              ADC_Get.Current_Value=ADC_Read_current_Value_average();
  440   3              if(X_Voltage_Line>=220){ //刷新固定的框架图
  441   4                    X_Voltage_Line=11;
  442   4                    X_Current_Line=10;
  443   4                    LCD_Fill(0,17,240,119,BLACK);
  444   4                    menu_Ui_main_Line(RED);
  445   4                    //显示最大电压和电流
  446   4                    // Voltage_Level_Flag;
  447   4      
  448   4      
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 8   

  449   4                if(C_Range.Current_Range_Flag_one== 1){         
  450   5                  //显示最小电压电流  
  451   5                  LCD_ShowString(213-12,3,"0.5A",BLUE,BLACK,12,0);
  452   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  453   5                }
  454   4                if(C_Range.Current_Range_Flag_tow== 1){         
  455   5                  //显示最小电压电流  
  456   5                  LCD_ShowString(213,3,"1A",BLUE,BLACK,12,0);
  457   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  458   5                }
  459   4                if(C_Range.Current_Range_Flag_three== 1){         
  460   5                  //显示最小电压电流  
  461   5                  LCD_ShowString(213,3,"5A",BLUE,BLACK,12,0);
  462   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  463   5                }
  464   4                if(C_Range.Current_Range_Flag_four== 1){          
  465   5                  //显示最小电压电流  
  466   5                  LCD_ShowString(213,3,"5A",BLUE,BLACK,12,0);
  467   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  468   5                }
  469   4              }
  470   3               if(ADC_Get.Voltage_Value<6){
  471   4                        //Voltage_Level_Flag
  472   4                      LCD_ShowString(9,3,"6V",YELLOW,BLACK,12,0);
  473   4                      LCD_ShowString(9,119,"0V",YELLOW,BLACK,12,0);
  474   4              
  475   4                      Line.ALL_Voltage_Value=114-(((ADC_Get.Voltage_Value-3)/9)*240);
  476   4                      //LCD_ShowIntNum(20,119,Line.ALL_Voltage_Value,4,YELLOW,BLACK,12); 
  477   4                      LCD_DrawLine(X_Voltage_Line,Y_Voltage_Line,X_Voltage_Line+=1,Line.ALL_Voltage_Value,YELLOW);
  478   4                      Y_Voltage_Line=Line.ALL_Voltage_Value;
  479   4                      
  480   4               }
  481   3               if(ADC_Get.Voltage_Value<=10&&ADC_Get.Voltage_Value>6){
  482   4                LCD_ShowString(9,3,"10V",YELLOW,BLACK,12,0);
  483   4                LCD_ShowString(9,119,"6V",YELLOW,BLACK,12,0);
  484   4                Line.ALL_Voltage_Value=114-(((ADC_Get.Voltage_Value-6)/12)*240);
  485   4                LCD_DrawLine(X_Voltage_Line,Y_Voltage_Line,X_Voltage_Line+=1,Line.ALL_Voltage_Value,YELLOW);
  486   4                Y_Voltage_Line=Line.ALL_Voltage_Value;           
  487   4               }
  488   3               if(ADC_Get.Voltage_Value<=13&&ADC_Get.Voltage_Value>10){
  489   4                  LCD_ShowString(9,3,"13V",YELLOW,BLACK,12,0);
  490   4                  LCD_ShowString(9,119,"10V",YELLOW,BLACK,12,0);
  491   4                  Line.ALL_Voltage_Value=114-(((ADC_Get.Voltage_Value-10)/9)*240);
  492   4                  LCD_DrawLine(X_Voltage_Line,Y_Voltage_Line,X_Voltage_Line+=1,Line.ALL_Voltage_Value,YELLOW);
  493   4                  Y_Voltage_Line=Line.ALL_Voltage_Value;           
  494   4               }if(ADC_Get.Voltage_Value<=16&&ADC_Get.Voltage_Value>13){
  495   4                  LCD_ShowString(9,3,"16V",YELLOW,BLACK,12,0);
  496   4                  LCD_ShowString(9,119,"13V",YELLOW,BLACK,12,0);
  497   4                  Line.ALL_Voltage_Value=114-(((ADC_Get.Voltage_Value-13)/9)*240);
  498   4                  LCD_DrawLine(X_Voltage_Line,Y_Voltage_Line,X_Voltage_Line+=1,Line.ALL_Voltage_Value,YELLOW);
  499   4                  Y_Voltage_Line=Line.ALL_Voltage_Value;           
  500   4               }if(ADC_Get.Voltage_Value<=21&&ADC_Get.Voltage_Value>16){
  501   4                  LCD_ShowString(9,3,"21V",YELLOW,BLACK,12,0);
  502   4                  LCD_ShowString(9,119,"16V",YELLOW,BLACK,12,0);
  503   4                  Line.ALL_Voltage_Value=114-(((ADC_Get.Voltage_Value-16)/15)*240);
  504   4                  LCD_DrawLine(X_Voltage_Line,Y_Voltage_Line,X_Voltage_Line+=1,Line.ALL_Voltage_Value,YELLOW);
  505   4                  Y_Voltage_Line=Line.ALL_Voltage_Value;           
  506   4               }
  507   3            //设置量程
  508   3              if(Time_Change_FLAG==8 && ADC_Get.Current_Value<=0.5){ //设置0-0.5A 量程
  509   4                if(C_Range.Current_Range_Flag_one== 0){
  510   5                  C_Range.Current_Range_Flag_tow=0;
  511   5                  C_Range.Current_Range_Flag_four=0;
  512   5                  C_Range.Current_Range_Flag_three=0; 
  513   5                  C_Range.Current_Range_Flag_five=0;  
  514   5                  C_Range.Current_Range_Flag_six=0;
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 9   

  515   5                  C_Range.Current_Range_Flag_seven=0; 
  516   5                  C_Range.Current_Range_Flag_eight=0;
  517   5                  C_Range.Current_Range_Flag_ten=0; 
  518   5                  C_Range.Current_Range_Flag_nine=0;            
  519   5                  LCD_Fill(212-12,2,240,15,BLACK);
  520   5                  LCD_Fill(212,118,240,135,BLACK);            
  521   5                  //显示最小电压电流  
  522   5                  LCD_ShowString(213-12,3,"0.5A",BLUE,BLACK,12,0);
  523   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  524   5                }         
  525   4                Line.ALL_Current_Value=117-(ADC_Get.Current_Value*195);
  526   4                C_Range.Current_Range_Flag_one=1;                   
  527   4              }else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>0.5 && ADC_Get.Current_Value<=1)){//设置0.5-1A
             - 量程
  528   4                if(C_Range.Current_Range_Flag_tow== 0){
  529   5                  C_Range.Current_Range_Flag_one=0;
  530   5                  C_Range.Current_Range_Flag_three=0;
  531   5                  C_Range.Current_Range_Flag_four=0;
  532   5                  C_Range.Current_Range_Flag_five=0;  
  533   5                  C_Range.Current_Range_Flag_six=0;
  534   5                  C_Range.Current_Range_Flag_seven=0; 
  535   5                  C_Range.Current_Range_Flag_eight=0;
  536   5                  C_Range.Current_Range_Flag_ten=0; 
  537   5                  C_Range.Current_Range_Flag_nine=0;
  538   5                  LCD_Fill(212-12,2,240,15,BLACK);
  539   5                  LCD_Fill(212,118,240,135,BLACK);            
  540   5                  //显示最小电压电流  
  541   5                  LCD_ShowString(213,3,"1A",BLUE,BLACK,12,0);
  542   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  543   5                }         
  544   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-0.5)*195);
  545   4                C_Range.Current_Range_Flag_tow=1;                                     
  546   4              }
  547   3              //*******************************1-1.5A电流量程************************************************       
  548   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>1 && ADC_Get.Current_Value<=1.5)){//设置1-1.5A 
             -量程
  549   4                if(C_Range.Current_Range_Flag_five== 0){
  550   5                  C_Range.Current_Range_Flag_one=0;
  551   5                  C_Range.Current_Range_Flag_three=0;
  552   5                  C_Range.Current_Range_Flag_four=0;
  553   5                  C_Range.Current_Range_Flag_tow=0; 
  554   5                  C_Range.Current_Range_Flag_six=0;
  555   5                  C_Range.Current_Range_Flag_seven=0; 
  556   5                  C_Range.Current_Range_Flag_eight=0;
  557   5                  C_Range.Current_Range_Flag_ten=0; 
  558   5                  C_Range.Current_Range_Flag_nine=0;            
  559   5                  LCD_Fill(212-12,2,240,15,BLACK);
  560   5                  LCD_Fill(212,118,240,135,BLACK);            
  561   5                  //显示最小电压电流  
  562   5                  LCD_ShowString(213-12,3,"1.5A",BLUE,BLACK,12,0);
  563   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  564   5                }         
  565   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-1)*195);
  566   4                C_Range.Current_Range_Flag_five=1;                                      
  567   4              }
  568   3              //*******************************1.5-2A电流量程************************************************
  569   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>1.5 && ADC_Get.Current_Value<=2)){
  570   4                if(C_Range.Current_Range_Flag_six== 0){
  571   5                  C_Range.Current_Range_Flag_one=0;
  572   5                  C_Range.Current_Range_Flag_three=0;
  573   5                  C_Range.Current_Range_Flag_four=0;
  574   5                  C_Range.Current_Range_Flag_tow=0; 
  575   5                  C_Range.Current_Range_Flag_five=0;
  576   5                  C_Range.Current_Range_Flag_seven=0; 
  577   5                  C_Range.Current_Range_Flag_eight=0;
  578   5                  C_Range.Current_Range_Flag_ten=0; 
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 10  

  579   5                  C_Range.Current_Range_Flag_nine=0;
  580   5                  LCD_Fill(212-12,2,240,15,BLACK);
  581   5                  LCD_Fill(212,118,240,135,BLACK);            
  582   5                  //显示最小电压电流  
  583   5                  LCD_ShowString(213,3,"2A",BLUE,BLACK,12,0);
  584   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  585   5                }         
  586   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-1.5)*195);
  587   4                C_Range.Current_Range_Flag_six=1;                                     
  588   4              }
  589   3              //*******************************2-2.5A电流量程************************************************
  590   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>2 && ADC_Get.Current_Value<=2.5)){
  591   4                if(C_Range.Current_Range_Flag_seven== 0){
  592   5                  C_Range.Current_Range_Flag_one=0;
  593   5                  C_Range.Current_Range_Flag_three=0;
  594   5                  C_Range.Current_Range_Flag_four=0;
  595   5                  C_Range.Current_Range_Flag_tow=0; 
  596   5                  C_Range.Current_Range_Flag_five=0;
  597   5                  C_Range.Current_Range_Flag_six=0; 
  598   5                  C_Range.Current_Range_Flag_eight=0;
  599   5                  C_Range.Current_Range_Flag_ten=0; 
  600   5                  C_Range.Current_Range_Flag_nine=0;
  601   5                  LCD_Fill(212-12,2,240,15,BLACK);
  602   5                  LCD_Fill(212,118,240,135,BLACK);            
  603   5                  //显示最小电压电流  
  604   5                  LCD_ShowString(213-12,3,"2.5A",BLUE,BLACK,12,0);
  605   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  606   5                }         
  607   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-2)*195);
  608   4                C_Range.Current_Range_Flag_seven=1;                                     
  609   4              }       
  610   3              //*******************************2.5-3A电流量程************************************************
  611   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>2.5 && ADC_Get.Current_Value<=3)){
  612   4                if(C_Range.Current_Range_Flag_eight== 0){
  613   5                  C_Range.Current_Range_Flag_one=0;
  614   5                  C_Range.Current_Range_Flag_three=0;
  615   5                  C_Range.Current_Range_Flag_four=0;
  616   5                  C_Range.Current_Range_Flag_tow=0; 
  617   5                  C_Range.Current_Range_Flag_five=0;
  618   5                  C_Range.Current_Range_Flag_six=0; 
  619   5                  C_Range.Current_Range_Flag_seven=0;
  620   5                  C_Range.Current_Range_Flag_ten=0; 
  621   5                  C_Range.Current_Range_Flag_nine=0;
  622   5                  LCD_Fill(212-12,2,240,15,BLACK);
  623   5                  LCD_Fill(212,118,240,135,BLACK);            
  624   5                  //显示最小电压电流  
  625   5                  LCD_ShowString(213,3,"3A",BLUE,BLACK,12,0);
  626   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  627   5                }         
  628   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-2.5)*195);
  629   4                C_Range.Current_Range_Flag_eight=1;                                     
  630   4              }
  631   3      //*******************************3-3.5A电流量程************************************************
  632   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>3 && ADC_Get.Current_Value<=3.5)){
  633   4                if(C_Range.Current_Range_Flag_nine== 0){
  634   5                  C_Range.Current_Range_Flag_one=0;
  635   5                  C_Range.Current_Range_Flag_three=0;
  636   5                  C_Range.Current_Range_Flag_four=0;
  637   5                  C_Range.Current_Range_Flag_tow=0; 
  638   5                  C_Range.Current_Range_Flag_five=0;
  639   5                  C_Range.Current_Range_Flag_six=0; 
  640   5                  C_Range.Current_Range_Flag_seven=0;
  641   5                  C_Range.Current_Range_Flag_ten=0; 
  642   5                  C_Range.Current_Range_Flag_eight=0;
  643   5                  LCD_Fill(212-12,2,240,15,BLACK);
  644   5                  LCD_Fill(212,118,240,135,BLACK);            
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 11  

  645   5                  //显示最小电压电流  
  646   5                  LCD_ShowString(213+12,3,"3.5A",BLUE,BLACK,12,0);
  647   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  648   5                }         
  649   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-3)*195);
  650   4                C_Range.Current_Range_Flag_nine=1;                                      
  651   4              }   
  652   3      //*******************************3-3.5A电流量程************************************************
  653   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>3.5 && ADC_Get.Current_Value<=4)){
  654   4                if(C_Range.Current_Range_Flag_ten== 0){
  655   5                  C_Range.Current_Range_Flag_one=0;
  656   5                  C_Range.Current_Range_Flag_three=0;
  657   5                  C_Range.Current_Range_Flag_four=0;
  658   5                  C_Range.Current_Range_Flag_tow=0; 
  659   5                  C_Range.Current_Range_Flag_five=0;
  660   5                  C_Range.Current_Range_Flag_six=0; 
  661   5                  C_Range.Current_Range_Flag_seven=0;
  662   5                  C_Range.Current_Range_Flag_nine=0;  
  663   5                  C_Range.Current_Range_Flag_eight=0;
  664   5                  LCD_Fill(212-12,2,240,15,BLACK);
  665   5                  LCD_Fill(212,118,240,135,BLACK);            
  666   5                  //显示最小电压电流  
  667   5                  LCD_ShowString(213,3,"4A",BLUE,BLACK,12,0);
  668   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  669   5                }         
  670   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-3.5)*195);
  671   4                C_Range.Current_Range_Flag_ten=1;                                     
  672   4              }         
  673   3              else if(Time_Change_FLAG==8 && (ADC_Get.Current_Value>4 && ADC_Get.Current_Value<=5)){        
  674   4                if(C_Range.Current_Range_Flag_three== 0){
  675   5                  C_Range.Current_Range_Flag_one=0;
  676   5                  C_Range.Current_Range_Flag_tow=0;
  677   5                  C_Range.Current_Range_Flag_four=0;
  678   5                  C_Range.Current_Range_Flag_five=0;  
  679   5                  C_Range.Current_Range_Flag_six=0;
  680   5                  C_Range.Current_Range_Flag_seven=0; 
  681   5                  C_Range.Current_Range_Flag_eight=0; 
  682   5                  C_Range.Current_Range_Flag_ten=0; 
  683   5                  C_Range.Current_Range_Flag_nine=0;            
  684   5                  LCD_Fill(212-12,2,240,15,BLACK);
  685   5                  LCD_Fill(212,118,240,135,BLACK);            
  686   5                  //显示最小电压电流  
  687   5                  LCD_ShowString(213,3,"5A",BLUE,BLACK,12,0);
  688   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  689   5                } 
  690   4                Line.ALL_Current_Value=117-((ADC_Get.Current_Value-3)*46);
  691   4                C_Range.Current_Range_Flag_three=1;
  692   4              }
  693   3              else if(Time_Change_FLAG!=8){       
  694   4                if(C_Range.Current_Range_Flag_four== 0){
  695   5                  C_Range.Current_Range_Flag_one=0;
  696   5                  C_Range.Current_Range_Flag_tow=0;
  697   5                  C_Range.Current_Range_Flag_three=0;
  698   5                  C_Range.Current_Range_Flag_five=0;  
  699   5                  C_Range.Current_Range_Flag_six=0;
  700   5                  C_Range.Current_Range_Flag_seven=0; 
  701   5                  C_Range.Current_Range_Flag_eight=0;
  702   5                  C_Range.Current_Range_Flag_ten=0; 
  703   5                  C_Range.Current_Range_Flag_nine=0;            
  704   5                  LCD_Fill(212-12,2,240,15,BLACK);
  705   5                  LCD_Fill(212,118,240,135,BLACK);            
  706   5                  //显示最小电压电流  
  707   5                  LCD_ShowString(213,3,"5A",BLUE,BLACK,12,0);
  708   5                  LCD_ShowString(213,119,"0A",BLUE,BLACK,12,0);                   
  709   5                }
  710   4                if(ADC_Get.Current_Value>3){          
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 12  

  711   5                  Line.ALL_Current_Value=117-(ADC_Get.Current_Value*19);
  712   5                }else if(ADC_Get.Current_Value<=3){
  713   5                  Line.ALL_Current_Value=117-(ADC_Get.Current_Value*31.66);           
  714   5                }
  715   4                C_Range.Current_Range_Flag_four=1;
  716   4              }
  717   3              
  718   3              
  719   3              LCD_DrawLine(X_Current_Line,Y_Current_Line,X_Current_Line+=1,Line.ALL_Current_Value,BLUE);
  720   3              Y_Current_Line=Line.ALL_Current_Value;
  721   3              X_Line_Loop_FLAG=0;
  722   3          }
  723   2        }
  724   1      }
  725          /*-------------------------------------------------------------
  726          *功能：三级菜单级->电压差曲线界面显示
  727          *作者：小夏
  728          *修改时间：2023.2.24
  729          *参考：大脑（自己）
  730          *-------------------------------------------------------------*/
  731          void menu_Ui_Voltage_Line_Menu(void){
  732   1        //显示当前电压和电流
  733   1        ADC_Get.Voltage_Value=ADC_Voltage_Read_Value_average();
  734   1        //显示电压 
  735   1        LCD_ShowFloatNum1(108,3,  ADC_Get.Voltage_Value,5,YELLOW,BLACK,12);
  736   1        LCD_ShowString(144,3,"V",YELLOW,BLACK,12,0);
  737   1        if(Begin_Stop_Ri_Flag==0){
  738   2        //显示纹波电压
  739   2          if(Voltage_Ripple_Nember>=97){
  740   3            Voltage_Ripple_Nember=13;
  741   3            LCD_Fill(156,18,234,116,BLACK);     
  742   3          }
  743   2          ADC_Max_Min=ADC_Sun_Value*1000;
  744   2          LCD_ShowFloatNum(171,Voltage_Ripple_Nember+=12,ADC_Max_Min,5,YELLOW,BLACK,12);
  745   2          LCD_ShowString(210,Voltage_Ripple_Nember,"mV",YELLOW,BLACK,12,0);
  746   2        
  747   2        if( ADC_GET_V_X>=150){
  748   3                  ADC_GET_V_X=10;
  749   3                  LCD_Fill(0,17,150,119,BLACK);
  750   3                  menu_Ui_main_Line_Wen(BRRED);
  751   3                  //LCD_ShowString(177,3,"Ripple",GREEN,BLACK,12,0); 
  752   3                  //LCD_DrawRectangle(155, 17, 235, 117,GREEN); 
  753   3                  LCD_ShowString(120,119,"200us",GREEN,BLACK,12,0);   
  754   3                if(Voltage_range_Flag==1){
  755   4                  LCD_ShowString(9,3,"+0.05V",YELLOW,BLACK,12,0);
  756   4                  LCD_ShowString(9,119,"-0.05V",YELLOW,BLACK,12,0);           
  757   4                }
  758   3                if(Voltage_range_Flag_Tow==1){
  759   4                  LCD_ShowString(9,3,"+0.1V",YELLOW,BLACK,12,0);
  760   4                  LCD_ShowString(9,119,"-0.1V",YELLOW,BLACK,12,0);
  761   4                }
  762   3                if(Voltage_range_Flag_Three==1){
  763   4                  LCD_ShowString(9,3,"+1V",YELLOW,BLACK,12,0);
  764   4                  LCD_ShowString(9,119,"-1V",YELLOW,BLACK,12,0);
  765   4                }
  766   3          }
  767   2        //设置电压量程
  768   2          if(ADC_Sun_Value<=0.05){
  769   3                CH_Y=100-(ADC_Sun_Value*1200);
  770   3                //显示最大电压最小电压
  771   3                if(Voltage_range_Flag==0){
  772   4                  Voltage_range_Flag_Three=0;
  773   4                  Voltage_range_Flag_Tow=0;
  774   4                  LCD_Fill(8,2,90,15,BLACK);
  775   4                  LCD_Fill(8,118,90,131,BLACK);
  776   4                  LCD_ShowString(9,3,"+0.05V",YELLOW,BLACK,12,0);
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 13  

  777   4                  LCD_ShowString(9,119,"-0.05V",YELLOW,BLACK,12,0);
  778   4                }
  779   3                Voltage_range_Flag=1;
  780   3          }else if(ADC_Sun_Value>0.05 && ADC_Sun_Value<=0.1){
  781   3      
  782   3                CH_Y=100-(ADC_Sun_Value*600);
  783   3                //显示最大电压最小电压
  784   3                if(Voltage_range_Flag_Tow==0){
  785   4                  Voltage_range_Flag_Three=0;
  786   4                  Voltage_range_Flag=0;
  787   4                  LCD_Fill(8,2,90,15,BLACK);
  788   4                  LCD_Fill(8,118,90,131,BLACK);
  789   4                  LCD_ShowString(9,3,"+0.1V",YELLOW,BLACK,12,0);
  790   4                  LCD_ShowString(9,119,"-0.1V",YELLOW,BLACK,12,0);
  791   4                }     
  792   3                Voltage_range_Flag_Tow=1;
  793   3          }else if(ADC_Sun_Value>0.1 && ADC_Sun_Value<=1){
  794   3                CH_Y=100-(ADC_Sun_Value*60);  
  795   3                if(Voltage_range_Flag_Three==0){
  796   4                  LCD_Fill(8,2,90,15,BLACK);
  797   4                  LCD_Fill(8,118,90,131,BLACK);
  798   4                  Voltage_range_Flag=0;
  799   4                  Voltage_range_Flag_Tow=0;
  800   4                  LCD_ShowString(9,3,"+1V",YELLOW,BLACK,12,0);
  801   4                  LCD_ShowString(9,119,"-1V",YELLOW,BLACK,12,0);
  802   4                }     
  803   3                Voltage_range_Flag_Three=1;
  804   3          }
  805   2      
  806   2          LCD_DrawLine( ADC_GET_V_X, ADC_GET_V_Y,ADC_GET_V_X++,CH_Y,YELLOW);        
  807   2          ADC_GET_V_Y=CH_Y;           
  808   2        }
  809   1      }
  810          /*-------------------------------------------------------------
  811          *功能：三级菜单级->过温过载界面显示
  812          *作者：小夏
  813          *修改时间：2023.2.24
  814          *参考：大脑（自己）
  815          *-------------------------------------------------------------*/
  816          void menu_Ui_Current_Temp_protect(void){
  817   1        //显示电流
  818   1        LCD_ShowChinese16x16(4,3,"现",WHITE,BLACK,16,0);
  819   1        LCD_ShowChinese16x16(4+16,3,"电",WHITE,BLACK,16,0); 
  820   1        LCD_ShowChinese16x16(4+32,3,"流",WHITE,BLACK,16,0);
  821   1        ADC_Get.Current_Value=ADC_Read_current_Value_average();//0.0399
  822   1        LCD_ShowFloatNum1(54,3, ADC_Get.Current_Value,5,BLUE,BLACK,16);
  823   1        LCD_ShowString(94+8,3,"A",BLUE,BLACK,16,0);
  824   1        //显示温度  
  825   1        LCD_ShowChinese16x16(129,3,"现",WHITE,BLACK,16,0);
  826   1        LCD_ShowChinese16x16(128+16,3,"温",WHITE,BLACK,16,0); 
  827   1      
  828   1        AHT10_Read_Humi_Temp(&AHT10.humi,&AHT10.temp);
  829   1        ALL_temp=((AHT10.temp/100)*10)+(AHT10.temp%100/10);
  830   1        sprintf(temp_char,"%d%d.%dC",AHT10.temp/100,AHT10.temp%100/10,AHT10.temp%100%10);
  831   1        LCD_ShowString(168,3,temp_char,RED,BLACK,16,0);
  832   1        //设电流
  833   1        LCD_ShowChinese16x16(4,19,"设",GREEN,BLACK,16,0);
  834   1        LCD_ShowChinese16x16(4+16,19,"电",GREEN,BLACK,16,0);  
  835   1        LCD_ShowChinese16x16(4+32,19,"流",GREEN,BLACK,16,0);
  836   1        
  837   1        LCD_ShowFloatNum1(54,19,C_T_P.protect_Current,5,PINK_RED,BLACK,16);
  838   1        LCD_ShowString(94+8,19,"A",PINK_RED,BLACK,16,0);
  839   1        //设温度  
  840   1        LCD_ShowChinese16x16(129,19,"设",RED,BLACK,16,0);
  841   1        LCD_ShowChinese16x16(128+16,19,"温",RED,BLACK,16,0);
  842   1        LCD_ShowFloatNum(168,19,C_T_P.protect_Temp,3,RED_NOW,BLACK,16);
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 14  

  843   1        LCD_ShowString(168+33,19,"C",RED_NOW,BLACK,16,0);
  844   1        
  845   1      }
  846          /*-------------------------------------------------------------
  847          *功能：四级菜单级->PD诱骗界面
  848          *作者：小夏
  849          *修改时间：2023.2.24
  850          *参考：大脑（自己）
  851          *-------------------------------------------------------------*/
  852          void menu_Ui_PD_Voltage_Current(void){
  853   1        ADC_Get.Voltage_Value=ADC_Voltage_Read_Value_average();
  854   1        //显示电压 36*36
  855   1        LCD_ShowFloatNum1(30,18,  ADC_Get.Voltage_Value,5,YELLOW,BLACK,16);
  856   1        LCD_ShowString(78,19,"V",YELLOW,BLACK,16,0);
  857   1        
  858   1        //显示电流 36*36  
  859   1        ADC_Get.Current_Value=ADC_Read_current_Value_average();//0.0399
  860   1        LCD_ShowFloatNum1(138+8,18, ADC_Get.Current_Value,5,BLUE,BLACK,16);
  861   1        LCD_ShowString(138+48+8,18,"A",BLUE,BLACK,16,0);      
  862   1          
  863   1          
  864   1      }
  865          /*-------------------------------------------------------------
  866          *功能：四级菜单级->QC诱骗界面
  867          *作者：小夏
  868          *修改时间：2023.2.24
  869          *参考：大脑（自己）
  870          *-------------------------------------------------------------*/
  871          void menu_Ui_QC_Voltage_Current(void){
  872   1      ADC_Get.Voltage_Value=ADC_Voltage_Read_Value_average();
  873   1        //显示电压 36*36
  874   1        LCD_ShowFloatNum1(30,18,  ADC_Get.Voltage_Value,5,YELLOW,BLACK,16);
  875   1        LCD_ShowString(78,19,"V",YELLOW,BLACK,16,0);
  876   1        
  877   1        //显示电流 36*36  
  878   1        ADC_Get.Current_Value=ADC_Read_current_Value_average();//0.0399
  879   1        LCD_ShowFloatNum1(138+8,18, ADC_Get.Current_Value,5,BLUE,BLACK,16);
  880   1        LCD_ShowString(138+48+8,18,"A",BLUE,BLACK,16,0);
  881   1      
  882   1      
  883   1        //显示D+和D-电压
  884   1        LCD_ShowString(132,86,"D+",PINK_RED,BLACK,16,0);
  885   1        LCD_ShowString(132,86+6+16,"D-",RED_NOW,BLACK,16,0);
  886   1        //D+
  887   1        ADC_Get.D_LEFT_Voltage_Value=ADC_D_LEFT_Read_Value_average();
  888   1        LCD_ShowFloatNum1(132+20,86,ADC_Get.D_LEFT_Voltage_Value,5,YELLOW,BLACK,16);
  889   1        LCD_ShowString(200,86,"V",YELLOW,BLACK,16,0);
  890   1        //D-
  891   1        ADC_Get.D_RIGHT_Voltage_Value=ADC_D_RIGHT_Read_Value_average();
  892   1        LCD_ShowFloatNum1(132+20,86+6+16,ADC_Get.D_RIGHT_Voltage_Value,5,YELLOW,BLACK,16);
  893   1        LCD_ShowString(200,86+6+16,"V",YELLOW,BLACK,16,0);
  894   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =     15864     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       136     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
C251 COMPILER V5.60.0,  menu_Ui                                                            24/02/23  15:31:32  PAGE 15  

  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       415     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
