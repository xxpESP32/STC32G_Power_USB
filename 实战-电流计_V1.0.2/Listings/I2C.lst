C251 COMPILER V5.60.0,  I2C                                                                24/02/23  15:19:38  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\I2C.obj
COMPILER INVOKED BY: D:\keil\C251\BIN\C251.EXE I2C\I2C.c XSMALL BROWSE INCDIR(.\ADC;.\I2C;.\LCD;.\System;.\UART1;.\Menu;
                    -.\KEY;..\实战-电流计_V2.0;.\Timer;.\SPI_Handler;.\CH224K;.\Pwm) DEBUG PRINT(.\Listings\I2C.lst) TABS(2) OBJECT(.\Objects
                    -\I2C.obj) 

stmt  level    source

    1          /*
    2          *注意：使用keil需要设置为GB2312
    3          *==============================硬件I2C源文件=======================
    4          *-------------------------------------------------------------------
    5          *文件修改历史
    6          *<时间>    | <版本>  | <作者>  | <功能>  
    7          *2023.2.24 | V1.0.2   | 小夏    | 硬件I2C配置
    8          *-------------------------------------------------------------------
    9          *如需要教学请到CSDN上面搜索"单片有机机"的STC32G专栏
   10          */
   11          
   12          #include "I2C.h"
   13          /*-------------------------------------------------------------
   14          *功能：硬件I2C初始化
   15          *作者：小夏
   16          *修改时间：2023.2.24
   17          *参考：<STC32G技术手册>
   18          *-------------------------------------------------------------*/
   19          void I2C_Init(u8 Mode){
   20   1        switch(Mode){
   21   2          case 1 :
   22   2              I2C_S1=0;
   23   2              I2C_S0=0;
   24   2          break;
   25   2          case 2 :
   26   2              I2C_S1=0;
   27   2              I2C_S0=1;
   28   2          break;
   29   2          case 3 :
   30   2              I2C_S1=1;
   31   2              I2C_S0=1;
   32   2          break;      
   33   2        }
   34   1        I2CCFG=0xe0;
   35   1        I2CMSST=0x00;
   36   1      }
   37          /*-------------------------------------------------------------
   38          *功能：硬件I2C的等待配置
   39          *作者：小夏
   40          *修改时间：2023.2.24
   41          *参考：<STC32G技术手册>
   42          *-------------------------------------------------------------*/
   43          static void Wait(void){
   44   1        while(!(I2CMSST & 0x40));
   45   1        I2CMSST &=~0x40;
   46   1      }
   47          /*-------------------------------------------------------------
   48          *功能：硬件I2C的起始位配置
   49          *作者：小夏
   50          *修改时间：2023.2.24
   51          *参考：<STC32G技术手册>
   52          *-------------------------------------------------------------*/
   53          void I2C_Start(void)
   54          {
   55   1        I2CMSCR =0x01;
   56   1        Wait(); 
   57   1      }
C251 COMPILER V5.60.0,  I2C                                                                24/02/23  15:19:38  PAGE 2   

   58          /*-------------------------------------------------------------
   59          *功能：硬件I2C的停止位配置
   60          *作者：小夏
   61          *修改时间：2023.2.24
   62          *参考：<STC32G技术手册>
   63          *-------------------------------------------------------------*/
   64          void I2C_Stop(void)
   65          {
   66   1        I2CMSCR =0x06;
   67   1        Wait(); 
   68   1      }
   69          /*-------------------------------------------------------------
   70          *功能：硬件I2C发送一个u8字节配置
   71          *作者：小夏
   72          *修改时间：2023.2.24
   73          *参考：<STC32G技术手册>
   74          *-------------------------------------------------------------*/
   75          void I2C_Send_Byte(u8 dat)
   76          {
   77   1        I2CTXD = dat;
   78   1        I2CMSCR = 0x02;
   79   1        Wait();
   80   1      }
   81          /*-------------------------------------------------------------
   82          *功能：硬件I2CACK等待配置
   83          *作者：小夏
   84          *修改时间：2023.2.24
   85          *参考：<STC32G技术手册>
   86          *-------------------------------------------------------------*/
   87          void I2C_Wait_ACK(void)
   88          {
   89   1        I2CMSCR = 0x03;
   90   1        Wait();
   91   1      }
   92          /*-------------------------------------------------------------
   93          *功能：硬件I2C读取一个u8字节配置
   94          *作者：小夏
   95          *修改时间：2023.2.24
   96          *参考：<STC32G技术手册>
   97          *-------------------------------------------------------------*/
   98          u8 I2C_Read_Byte(void)
   99          {
  100   1        I2CMSCR =0x04;
  101   1        Wait();
  102   1        return I2CRXD;
  103   1        
  104   1      }
  105          /*-------------------------------------------------------------
  106          *功能：硬件I2CACK应答配置
  107          *作者：小夏
  108          *修改时间：2023.2.24
  109          *参考：<STC32G技术手册>
  110          *-------------------------------------------------------------*/
  111          void I2C_ACK(void)
  112          {
  113   1        I2CMSST =0x00;
  114   1        I2CMSCR =0x05;
  115   1        Wait();
  116   1        
  117   1      }
  118          /*-------------------------------------------------------------
  119          *功能：硬件I2CNCK非应答配置
  120          *作者：小夏
  121          *修改时间：2023.2.24
  122          *参考：<STC32G技术手册>
  123          *-------------------------------------------------------------*/
C251 COMPILER V5.60.0,  I2C                                                                24/02/23  15:19:38  PAGE 3   

  124          void I2C_NACK(void)
  125          {
  126   1        I2CMSST =0x01;
  127   1        I2CMSCR =0x05;
  128   1        Wait();
  129   1        
  130   1      }
  131          /*-------------------------------------------------------------
  132          *功能：硬件I2C等待延时配置
  133          *作者：小夏
  134          *修改时间：2023.2.24
  135          *参考：<STC32G技术手册>
  136          *-------------------------------------------------------------*/
  137          void I2C_Delay(void){
  138   1        
  139   1        int i;
  140   1        for(i=0;i<3000;i++)
  141   1        {
  142   2          _nop_();
  143   2          _nop_();
  144   2          _nop_();
  145   2          _nop_();
  146   2        }
  147   1        
  148   1      }
  149          
  150          
  151          
  152          
  153          
  154          
  155          
  156          
  157          
  158          
  159          
  160          
  161          
  162          
  163          
  164          
  165          
  166          
  167          
  168          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       241     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
